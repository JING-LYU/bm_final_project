---
title: "Jing Lyu"
author: "LYU JING"
date: "11/22/2021"
output: github_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library,warning=FALSE,message=FALSE}
library(tidyverse)
library(corrplot)
```
## Data Preprocessing

```{r preprocess}
cdi_data = read.csv("./data/cdi.csv") %>%
  janitor::clean_names() %>%
  mutate(
    cty_state = str_c(cty,",",state),
    docs_rate_1000 = 1000 * docs/pop, # Compute number of doctors/hospital beds per 1000 people.
    beds_rate_1000 = 1000 * beds/pop,
    crime_rate_1000 = 1000 * crimes/pop) %>% # Compute number of crimes per 1000 people.) 
  select(-docs,-beds,-crimes) %>%
  relocate(id,cty_state,cty)
```

```{r corrplot}
cdi_cor = cdi_data %>%
  select(-id,-cty,-state, -cty_state) %>%
  cor() 
 
corrplot(cdi_cor)
```

```{r}

# Scatter plot 
cdi_data %>% 
  ggplot(aes(poverty, crime_rate_1000)) + geom_point(color='blue') + theme_bw(base_size=20) +
  geom_smooth(method='lm', se=TRUE, color='red') +
  labs(x="Percent below poverty level", y="CRM_1000")

# Simple linear regression: crm_1000 vs poverty
cdi_pov = lm(crime_rate_1000 ~ poverty, data = cdi_data)
summary(cdi_pov)


cdi_pov = lm(crime_rate_1000 ~ poverty + beds_rate_1000, data = cdi_data)
summary(cdi_pov)

# this one is the best!
cdi_pov = lm(crime_rate_1000 ~ poverty + docs_rate_1000 , data = cdi_data)
summary(cdi_pov)

cdi_pov = lm(crime_rate_1000 ~ poverty + docs_rate_1000 + beds_rate_1000 , data = cdi_data)
summary(cdi_pov)

```


```{r}
ggplot(birth, aes(x = age, y = bwt, color = smoke)) + 
  geom_point() +
  geom_smooth(method="lm", se=F, aes(group = smoke, color = smoke)) +
  theme_bw()

# fit model with interaction
interact = lm(bwt ~ age*smoke, data = birth)
summary(interact)
```


```{r}

library(leaps)
models <- regsubsets(crime_rate_1000~., data = cdi_data, really.big=T,nvmax = 5)
summary(models)
```

