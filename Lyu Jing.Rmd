---
title: "Jing Lyu"
author: "LYU JING"
date: "11/22/2021"
output: github_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library,warning=FALSE,message=FALSE}
library(tidyverse)
library(corrplot)
```
## Data Preprocessing

```{r preprocess}
cdi_data = read_csv("./data/cdi.csv") %>%
  janitor::clean_names() %>%
  mutate(
    cty_state = str_c(cty,",",state),
    docs_rate_1000 = 1000 * docs/pop, # Compute number of doctors/hospital beds per 1000 people.
    beds_rate_1000 = 1000 * beds/pop,
    crime_rate_1000 = 1000 * crimes/pop) %>% # Compute number of crimes per 1000 people.) 
  select(-docs,-beds,-crimes) %>%
  relocate(id,cty_state,cty)

knitr::kable(head(cdi_data))
```









### Model construction

Data used for building model:

```{r}
cdi_model = cdi_data %>% 
  select(-id,-cty_state, -cty,-state) %>% 
  mutate(region = factor(region))
```
```{r}

# test covariable

model1 = lm(crime_rate_1000 ~ pcincome + bagrad, data = cdi_model)
summary(model1)
model2 = lm(crime_rate_1000 ~ pcincome * bagrad, data = cdi_model)
summary(model2)


model1 = lm(crime_rate_1000 ~ pop + area, data = cdi_model)
summary(model1)
model2 = lm(crime_rate_1000 ~ pop * area, data = cdi_model)
summary(model2)
```
# interaction
```{r}
# MLR
regmulti4_hos = lm(crime_rate_1000 ~ ., data = cdi_model)
summary(regmulti4_hos)

# 'General' global test for all predictors
anova(regmulti4_hos)

# MLR with interaction
regmult5_hos = lm(LOS ~ INFRISK*MEDSCHL, data = data_hosp)
summary(regmult5_hos)

# Vizualize interaction for reg5: LOS vs INFRISK by MS affiliation
qplot(x = INFRISK, y = LOS, color = factor(MEDSCHL), data = data_hosp) +
  geom_smooth(method = "lm", se=FALSE) +
  theme_bw() +
  labs(x="Infection Risk", y="Length of stay (days)", color = "Med School") 

# Lines look fairly parallel, in line with the non-sig interaction result.


```


